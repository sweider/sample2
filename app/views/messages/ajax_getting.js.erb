$(document).ready(function(){
  var messageWindow = $("#messageModal");
  var body_default = "<%= escape_javascript(render 'shared/modal_body') %>";

  messageWindow.find("#modal-body").html = body_default;
  messageWindow.find("#sender").text("<%= @sender.login %>");
  messageWindow.find("#reciever").text("<%= @reciever.login %>");
  messageWindow.find("#message-text").text(" <%= wrap(@message.content) %>");

  <% own_message = current_user.id  ==  @message.user_id%>
  if (<%= own_message %>)
    messageWindow.find("#toggle-form").text("Write message");
  else
    messageWindow.find("#toggle-form").text("Answer");
  
  messageWindow.modal('show');

  messageWindow.find("button").on("click", function(){    

    if (<%= own_message %>)
      <% user_id = @message.to %>;
    else
      <% user_id = @message.user_id %>;

    var form = "<%=  escape_javascript(render 'users/new_message_form', user_id: user_id) %>";
    messageWindow.find(".modal-body").append(form);
  });

  messageWindow.find("#modal-close-btn").on("click", function(){
    messageWindow.modal("hide");
  });

  messageWindow.on("hide", function(){
    $(this).find("#message-form").remove();
  });

});